# 汇编语言程序设计

## 汇编部份考试要求

1.理解指令系统的概念及指令格式

2.掌握常用的寻址方式并能熟练地使用它们

3.掌握常用指令的格式、功能和使用方法，分析各种指令执行后的结果。

4.掌握指令对状态标志的影响

5.掌握常用伪指令的格式和功能

6.掌握汇编语言源程序的构成

7.熟练掌握汇编语言程序上机调试运行过程

8.理解程序的三种基本结构，能够使用汇编语言解决常见的问题。

# 第四章	8088/8086指令系统

### 4.1	8088/8086的寻址方式

#### 1.汇编语言的两种语句格式

（1）执行性语句：指令（也称为硬指令）

（2）说明性语句：伪指令

（3）宏指令

#### 2.指令的组成

#### （1）由操作码和操作数（地址码组成）

#### （2）操作数类型：

操作数：立即数，寄存器，存储器

> 1.双地址：双操作数	操作码	dst（目的），src（源）
>
> ​										MOV		AL			，	BL
>
> 2.单地址：单操作数	 
>
> > 助记符
> >
> > INC	AX ；			AX+1-》AX
>
> 3.零地址：无操作数 	只有操作码

#### （3）操作数的表示

<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/2991676190382_.pic.jpg" alt="2991676190382_.pic" style="zoom:60%;" />

<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3001676190443_.pic.jpg" alt="3001676190443_.pic" style="zoom:60%;" />

#### 3.操作数的寻址方式

（1）寻址方法：寻找操作数或操作数地址的方式

（2）寻址种类：立即数寻址方式、寄存器寻址方式、存储器寻址方式

#### 4.立即数寻址方式

#### （1）特点：

>操作数作为指令的一部分存放在操作码之后的代码段的主存单元中<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3031676191270_.pic.jpg" alt="3031676191270_.pic" style="zoom:25%;" />
>
>立即数(imm):
>
>​			8位数值i8( 00H~FFH )
>
>​			16位数值i16( 0000H ~ FFFFH )
>
>​			字符常量
>
>只能在src的位置

<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3041676191619_.pic.jpg" alt="3041676191619_.pic" style="zoom:60%;" />

#### 5.寄存器寻址方式

#### （1）特点

> 操作数存放在CPU的内部寄存器reg中:
>
> ​			8位寄存器r8:
>
> ​			16位寄存器r16:
>
> ​			4个段寄存器seg:
>
> 寄存器名表示其内容 (操作数)
>
> CS不能在dst，只能在src位置。

<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3061676193258_.pic.jpg" alt="3061676193258_.pic" style="zoom:50%;" />

#### 6.存储器寻址方式

操作数在主存储器中，用主存EA表示

8086设计了5种存储器寻址方式：

​						直接寻址方式

​						寄存器简介寻址方式

​						寄存器相对寻址方式

​						基址变址寻址方式

​						相对基址变址寻址方式

#### （1）直接寻址方式

1⃣️有效地址EA在指令中直接给出

2⃣️中括号内表示有效地址EA

3⃣️默认的段地址DS，可用段超越前缀改变

​				MOV	AX，ES：[2000H]

![3081676194580_.pic](/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3081676194580_.pic.jpg)

#### （2）寄存器间接寻址方式

EA存放在BX，SI，DI或BP中；

EA为BX/SI/DI时，默认是DS	BP默认是SS

可使用段超越前缀改变

![3091676195115_.pic](/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3091676195115_.pic.jpg)

#### （3）寄存器相对寻址方式

EA=BX/BP/SI/DI+8/16位位移量

BX/SI/DI默认是DS	BP默认是SS

可使用段超越前缀改变

![3111676196289_.pic](/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3111676196289_.pic.jpg)

#### （4）基址变址寻址方式

EA=BX/BP+SI/DI

BX、SI、DI、默认是DS	BP默认SS

可使用段超越前缀改变

![3121676196716_.pic](/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3121676196716_.pic.jpg)

#### （5）相对基址变址寻址方式

EA=BX/BP+SI/DI+8/16位位移量

BX、SI、DI、默认是DS	BP默认SS

可使用段超越前缀改变

![3131676197198_.pic](/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3131676197198_.pic.jpg)

### 4.2	数据传送类指令

传送指令把 数据从一个位置传送到另一个位置

除标志寄存器传送指令外，均不影响标志位（CF、OF、IF、SF、PF、AF）。

重点掌握：：MOV	XCHG	PUSH	POP	LEA

了解：XLAT	LDS	LES

#### 1.传送指令MOV（move）

##### 立即数传送	<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3141676198274_.pic.jpg" alt="3141676198274_.pic" style="zoom:25%;" />

##### 寄存器传送	<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3151676198371_.pic.jpg" alt="3151676198371_.pic" style="zoom:25%;" />

##### 存储器传送	<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3161676198517_.pic.jpg" alt="3161676198517_.pic" style="zoom:25%;" />

##### 段寄存器传送	<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3171676198569_.pic.jpg" alt="3171676198569_.pic" style="zoom:25%;" />

##### MOV指令传送功能图解

<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3181676198794_.pic.jpg" alt="3181676198794_.pic" style="zoom:50%;" />

#### 非法指令

>1⃣️两个操作数类型不一致
>
>​	在绝大多数双操作数指令中：目的操作数和源操作数必须具有一致的数据类型
>
>2⃣️无法确定是字节还是字操作
>
>​	当无法通过任一个操作数确定操作类型时，*需要利用汇编语言的操作符显式指明*。
>
><img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3191676199656_.pic.jpg" alt="3191676199656_.pic" style="zoom:50%;" />
>
>3⃣️两个操作数都是存储器
>
>​	8088指令系统除串操作指令外，*不允许两个操作数都是存储单元（存储器操作数）*
>
><img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3201676200341_.pic.jpg" alt="3201676200341_.pic" style="zoom:33%;" /><img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3211676200520_.pic.jpg" alt="3211676200520_.pic" style="zoom:33%;" />
>
>4⃣️段寄存器的操作有限制
>
><img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3221676200827_.pic.jpg" alt="3221676200827_.pic" style="zoom:50%;" />

#### 2.交换指令XCHG（exchange）

把两个地方的数据进行交换

XCHG	reg（目的），reg/mem

<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3231676201184_.pic.jpg" alt="3231676201184_.pic" style="zoom:60%;" />

#### 3.换码指令XLAT（translate）

XLAT		；al《-  ds：[bx+al]

将BX指定的缓冲区中、AL指定的位移处的一个字节数据取出赋给AL

<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3241676202328_.pic.jpg" alt="3241676202328_.pic" style="zoom:50%;" />

#### 4.LEA（load effective address）

LEA	r16,mem

<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3261676254187_.pic.jpg" alt="3261676254187_.pic" style="zoom:60%;" />

<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3271676254651_.pic.jpg" alt="3271676254651_.pic" style="zoom:60%;" />

<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3281676254788_.pic.jpg" alt="3281676254788_.pic" style="zoom:33%;" />

#### 5.堆栈操作指令

堆栈占用主存区域,采用“后进先出”或“先进后出”原则，位于堆栈段中，段地址保存在SS段寄存器。

堆栈只有一个出口，栈顶;用堆栈指针寄存器SP指定栈顶位置。

堆栈只有两种基本操作: 进栈PUSH和出栈POP（字为单位）

##### （1）进栈指令PUSH 

PUSH	r16/m16/seg。 				：单地址指令	源操作数

1⃣️SP《--   SP-2

2⃣️SS：[SP] 《-- r16/m16/seg

<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3301676256976_.pic_hd.jpg" alt="3301676256976_.pic_hd" style="zoom:60%;" />

（2）出栈指令POP

POP	r16/m16/seg。 				：单地址指令	源操作数

1⃣️r16/m16/seg《-- SS：[SP] 

2⃣️ SP-2《-- SP

<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3311676257352_.pic.jpg" alt="3311676257352_.pic" style="zoom:60%;" />

总结：堆栈操作的特点

进栈和出栈只对字量。

字量数据从栈顶压入和弹出时，都是低地址字节送低字节高地址字节送高字节

堆栈操作遵循先进后出原则

堆栈段是程序中不可或缺的一个内存区，常用来

​		临时存放数据

​		传递参数

​		保存和恢复寄存器

#### 6.标志操作指令

##### 1.标志操作指令

CLC	CF=0

STC	CF=1

CMC	CF取反

CLD	DF=0

STD	DF=1

CLI	IF=0

STI	IF=1

##### 2.标志寄存器低字节传送AH的指令：LAHF

##### 3.标志寄存器出入堆栈指令：PUSHF、POPF

​																						只有POPF影响6个状态位

### 4.3	算术运算类指令

运算结果对状态标志位影响

重点掌握

​		加法：ADD、ADC、INC

​		减法：SUB、SBB、DEC、CMP、NEG

​		符号扩展：CBW、CWD

​		乘法：无符号 MUL 	DIV

​					有符号IMUL	IDIV

#### 1.加法和减法指令

ADD	dest，src								；dest《--	dest+src

SUB	dest，src								  ；dest 《--	dest-src

例<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3331676262704_.pic.jpg" alt="3331676262704_.pic" style="zoom:67%;" />



<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3341676263364_.pic.jpg" alt="3341676263364_.pic" style="zoom:60%;" />

#### 2.带进位加和减指令

ADC	dest，src					；dest《--	dest+src+CF

SBB	dest，src					；dest《--	dest-src-CF

<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3351676263903_.pic.jpg" alt="3351676263903_.pic" style="zoom:50%;" /><img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3361676263903_.pic.jpg" alt="3361676263903_.pic" style="zoom:60%;" />

<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3371676264122_.pic.jpg" alt="3371676264122_.pic" style="zoom:50%;" />

#### 3.比较指令CMP（compare）

CMP	dest，src					；dest-src

差值不回送目的操作数

影响状态标志

#### 4.增量和减量指令

INC	reg/mem

DEC	reg/men

均为单操作指令数

INC和DEC不影响CF标志，其他标志位影响

![3381676268037_.pic](/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3381676268037_.pic.jpg)

<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3391676272237_.pic.jpg" alt="3391676272237_.pic" style="zoom:60%;" />

#### 5.求补指令NEG（negtive）

NEG	reg/mem					；reg/mem《-- 0-reg/mem

单操作数指令		影响标志位

<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3401676272862_.pic.jpg" alt="3401676272862_.pic" style="zoom:33%;" />

#### 6.符号扩展指令

扩展的高部分仅是低部份的符号扩展

CBD		；AL符号扩展成AX

CWD		；AX符号扩展成DX

1⃣️零地址

2⃣️隐含寻址	AL -》AX

​						AX -》DX

<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3411676273366_.pic.jpg" alt="3411676273366_.pic" style="zoom:50%;" />

#### 7.乘法和除法指令

##### （1）乘法指令

分无符号和有符号指令

单操作数指令（隐含使用AL和AX）

指令：MUL 	OPR		；		UMUL	OPR

格式：AL * OPR（字节） -》AX

​			AX * OPR（字） -》DX、AX

OPR不能是立即数，可以是reg/mem

对标志位影响：字节*字节=字节 ：CF=OF = 0

​							字节*字节=字     ：CF=OF = 1

​							字*字=字			：CF=OF = 0

​							字*字=双字		：CF=OF = 1

其他标志位无定义

<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3421676277632_.pic.jpg" alt="3421676277632_.pic" style="zoom:50%;" />

##### （2）除法指令

分无符号和有符号指令

单操作数指令

DIV		OPR

IDIV		OPR

格式：字（AX）/字节（OPR） -》字节		商：AL	余数：AH

​			双字（DX、AX）/字 （OPR）-》 字		  商：AX	余数：DX

OPR不能是立即数，可以是reg/mem

除数为0或商超出范围，OF=1溢出

其他标志位无定义

### 4.4	位操作类指令

以二进制位进行数据操作

注意：对标志位的影响

1.逻辑运算指令  	AND 	OR	XOR	NOT	TEST

2.位移指令	SHL	SHR	SAL	SAR

3.循环移位指令	ROL	ROR	RCL	RCR

#### 一、逻辑运算指令

双操作作数：AND、OR、XOR、TEST

设置：CF=OF=0

结果影响SF、ZF、PF状态，对AF未定义

单操作数：NOT不影响任何标志位

##### 1.逻辑与：AND

AND	dest，src				；dest《--dest $\wedge$ src

<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3431676279146_.pic.jpg" alt="3431676279146_.pic" style="zoom:50%;" />

##### 2.逻辑或指令OR

有1就有1

OR	dest，src				；dest 《--dest $\vee$ src

<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3451676279448_.pic.jpg" alt="3451676279448_.pic" style="zoom:60%;" />

##### 3.逻辑异或指令XOR

相同为0，不同为1

XOR	dest，src			；dest 《-- dest$\oplus$src

<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3461676279723_.pic.jpg" alt="3461676279723_.pic" style="zoom:60%;" />

##### 4.测试指令TEST

TEST	dest，src				；dest$\wedge$src

<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3521676282496_.pic.jpg" alt="3521676282496_.pic" style="zoom:60%;" />

测试D0是否为1，若D0=1，奇数（结果$\neq$0，ZF=0 =〉 JNZ）

<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3531676283005_.pic.jpg" alt="3531676283005_.pic" style="zoom:60%;" />

测试D0是否为0，若D0=0，偶数（ZF=1 =〉 JZ）

##### 5.逻辑非指令NOT

NOT	reg/mem

取反

单操作数指令

不影响任何操作位

<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3541676283325_.pic.jpg" alt="3541676283325_.pic" style="zoom:50%;" />

###### 清零指令<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3471676279723_.pic.jpg" alt="3471676279723_.pic" style="zoom:25%;" />

#### 二、移位指令

逻辑（无符号数）和运算（有符号数）

左移或者右移，移出的位进入CF

移位后结果影响SF、ZF、PF

##### 1.逻辑左移指令SHL

SHL	reg/mem，1/CL		；移位次数$\geq$2时，要把移位次数放到CL中<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230213185443086.png" alt="image-20230213185443086" style="zoom:25%;" />

​													最低位补0，最高位进入CF<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230213185535259.png" alt="image-20230213185535259" style="zoom:30%;" />

##### 2.逻辑右移指令SHR

SHR	reg/mem，1/CL		最高位补0，最低位进入CF<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230213190223647.png" alt="image-20230213190223647" style="zoom:33%;" />

##### 3.算术左移指令SAL

SAL	reg/mem，1/CL			<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230213191128536.png" alt="image-20230213191128536" style="zoom:33%;" />

##### 4.算术右移指令SAR

SAR	reg/mem，1/CL			最高位不变，最低位进入CF	<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230213191140381.png" alt="image-20230213191140381" style="zoom:33%;" />

#### 三、循环移位指令

分为：ROL	reg/mem，1/CL

​			ROR	reg/mem，1/CL

​			RCL	reg/mem，1/CL			；带进位循环左移

​			RCR	reg/mem，1/CL			；带进位循环右移

设置进位标志CF

不影响SF、ZF、PF、AF标志

### 4.5控制转移类指令

用于实现分支、循环、子程序等结构

通过改变IP（和CS）值，实现程序执行的改变。

重点掌握：

​		JMP、JCC

​		LOOP

​		CALL/RET

​		INT n、IRET		常用系统功能调用

#### 一、无条件转移指令

JMP 标号 	1.标明指令位置

​					2.字母+字母/数字

#### 二、条件转移指令

JCC 标号 ；条件满足，转移到标号位置

​				；否则，顺序执行

标号 ：一个8位位移量

##### JCC指令的分类

​	不影响标志位，但利用标志

​	根据标志位不同，分成三种情况

> 判断单个标志位状态		<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230213211619339.png" alt="image-20230213211619339" style="zoom:33%;" />
>
> 比较无符号数的高低
>
> 比较有符号数大小

![3681676294405_.pic](/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3681676294405_.pic.jpg)

##### 1.判断单个标志位状态

（1）JZ/JE和JNZ/JNE

ZF=1 结果 = 0 								等于时怎么做

ZF = 0 结果 = 1								不等于怎么做

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230213213443888.png" alt="image-20230213213443888" style="zoom:60%;" />

（2）JS和JNS 		有符号数

SF = 1 为	负 									结果为负怎么做

SF = 0 JSN -》为正							结果为正怎么做

（3）JC和JNC

CF = 1			CF = 0						小于/大于时怎么做

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230213213824911.png" alt="image-20230213213824911" style="zoom:60%;" />

##### 例一：<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230213214245021.png" alt="image-20230213214245021" style="zoom:60%;" />

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230213215240641.png" alt="image-20230213215240641" style="zoom:60%;" />

##### 例二：<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230213215257156.png" alt="image-20230213215257156" style="zoom:60%;" />

##### 2.比较无符号数高低

JB (JNAE):低于(不高于等于)

JNB (JAE):不低于(高于等于)

JBE (JNA):低于等于 (不高于)

JNBE（JA）:不低于等于(高于)

<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3781676299361_.pic_hd.jpg" alt="3781676299361_.pic_hd" style="zoom:60%;" />

##### 3.比较有符号数大小

JL (JNGE):小于(不大于等于)

JNL (JGE) :不小于 (大于等于)

JLE (JNG):小于等于 (不大于)

JNLE (JG):不小于等于 (大于)

<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/3791676299707_.pic.jpg" alt="3791676299707_.pic" style="zoom:60%;" />

#### 三、循环指令

88/86有针对CX计数器的计数循环指令

LOOP	label		<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230213231826108.png" alt="image-20230213231826108" style="zoom:33%;" />

##### 例一、![image-20230213234950232](/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230213234950232.png)

##### 例二、![image-20230213235026633](/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230213235026633.png)

##### 例三、<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230213235035103.png" alt="image-20230213235035103" style="zoom:33%;" /><img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230213235109926.png" alt="image-20230213235109926" style="zoom:33%;" />

#### 四、子程序指令

子程序是完成特定功能的一段程序

主程序采用CALL调用指令转移到子程序的起始处执行

运行完子程序后，采用RET指令回到主程序继续执行

CALL	子程序名 

……

ret

#### 五、中断指令和系统功能

中断指令：INT	i8

​					IRET

系统功能调用	INT 21H

##### 系统功能调用方法 （P396）

DOS利用21H号中断重点掌握:

​		键盘接收一个字符: 01H号

​		输出一个字符:02H号

​		输出一个字符串: 09H号

​		设置设置中断向量:25H号

​		获取设置中断向量:35H号

​		返回DOS: 4CH号

##### 01H号DOS功能调用

键盘接收一个字符

​	(1)功能调用号:AH=01H										此时DOS显示光标等待输入	

​	(2)出口参数:AL=键盘接收的字符的ASCII码

​	(3)功能调用:INT 21H

MOV	ah，01H

INT	21H

##### 02H号DOS功能调用

输出显示一个字符

（1）功能调用号:AH=01H

（2）入口参数：DL=欲显示字符的ASCLL码

（3）功能调用：INT	21H

MOV	AH，02H

MOV	DL，___

INT	21H

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230215170101149.png" alt="image-20230215170101149" style="zoom:60%;" />

![image-20230215170112193](/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230215170112193.png)

##### 09H号DOS功能调用

输出一个字符串

（1）功能调用号：AH=09H

（2）入口参数：

​			DS：DX=欲显示字符串在内存中的首地址；

​			最后必须以“$”结尾（并不显示）

（3）功能调用：INT	21H

![image-20230215172232593](/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230215172232593.png)

##### 25H号DOS功能调用

功能：设置中断类型号为N的中断服务程序的入口地址，存入DS：DX

MOV	DX，OFFSET	SERV	；SERV为中断服务子程序的名称

MOV	AX，SEG	SERV

MOV	DS，AX

MOV	AL,N

MOV	AH,25H

INT	21H

##### 35H号DOS功能调用

功能：获取中断类型号为N的中断向量ES：BX，并存入变量INTOFF 和 INTSEG中

MOV	AL，N

MOV	AH，35H

INT	21H

MOV	INTOFF，BX

MOV	INTSEG，ES

### 4.6串操作类

（1）传送：从源存储区到目的区

​					MOVSB

​					MOVSW

（2）存入串：将AL/AX的内容存入目的的存储区

​					STOSB/STOSW

（3）从串取：将源存储区的内容送AL/AX

​					LODSB/LODSW

（4）比较源和目的串：

​					CMPSB

​					CMPSW

（5）串扫描：将AL/AX的内容与目的串的一个数据比较

​					SCASB/SCASW

（6）REP

​			CX《--	CX-1

​			判断（CX）=0？如（CX）=0退出

（7）REPE/REPZ

​			CX 《-- （CX）-1

​		判断CX=0或ZF=0则退出

（8）串重复前缀REPNE/REPNZ

​		CX《--（CX）-1

​	判断CX=0 或 ZF =1 则退出

![image-20230215174522953](/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230215174522953.png)

![image-20230215174529119](/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230215174529119.png)

1.零地址指令

2.源串DS:[SI]，目的串ES:[DI]，程序框架中需定义数据段和附加段

3.源串首/末地址	--》SI，目的串首/末地址--〉DI

4.指令执行后，SI/DI土1/2

5.地址增量 (CLD/DF=0)

  地址减量(STD/DF=1)

### 4.7处理器控制类指令

NOP	；空操作指令

HLT	；暂停指令：CPU进入暂停状态



### 第四章：总结

88/86CPU16位指令系统的常用指令

1.操作数寻址方式

2.操作数形式

3.常用指令的助记符和功能

4.指令对标志位的影响

5.隐含寄存器的情况

![image-20230215175458626](/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230215175458626.png)

数据传送: MOV、XCHG、PUSH、POP、LEA

加减运算:ADD / SUB、ADC / SBB、CMP、INC / DEC

位操作:AND / OR / XOR / NOT / TEST、SHL / SHR / SAL /SAR、ROL / ROR /RCL / RCR

控制转移: JMP /Jcc / LOOP、INT n

# 第五-六章	汇编语言程序设计

## 知识重点

汇编语言源程序格式与编写

常量、变量和标号

汇编语言程序设计方法

​	-顺序程序设计

​	-分支程序设计

​	-循环程序设计

## 一、汇编语言的语句格式

#### 1.语句的类型：

包括三类：执行性语句：指令

​					说明性语句：伪指令

​					宏指令语句：宏指令

#### （1）执行性语句

硬指令（Instruction），使CPU产生动作（源文件.sam经过汇编（MASM.exe）形成.obj目标代码	链接（Link.exe））、

程序执行时处理的语句，汇编（MASM.exe）后产生机器目标代码

#### （2）说明性语句

伪指令（Directive），不产生CPU动作，指示源程序的汇编、变量定义、过程设置等。

#### 2.格式说明

#### （1）标号：

反映指令位置和属性的标识符，后跟“冒号”

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230215181619638.png" alt="image-20230215181619638" style="zoom:50%;" />

#### （2）名字：变量

反映伪指令（数据首）位置和属性的标识符，后跟空格分割

![image-20230215182117044](/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230215182117044.png)

#### （3）标识符（Identifier）

一般最多由31个字母、数字及规律的特殊符号（如	_ $ ? @）组成

不能以数字开头

默认情况下，汇编程序不区分字母大小写；

一个源程序中，每个标识符的定义是唯一的

不能是保留字

#### （4）保留字（Reserved Word）

保留字是汇编程序已经利用的标识符（关键字），主要有：

​	指令助记符：MOV，ADD

​	伪指令助记符：DB、segment

​	操作符：OFFSET、PTR

​	寄存器名：AX、CS

#### （5）注释

语句中由分号“；”开始的部分，用以增加源程序的可读性；

汇编程序在汇编源程序时，不对注释做任何处理。

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230215183814996.png" alt="image-20230215183814996" style="zoom:33%;" />

#### （6）分隔符

语句的4个组成部分要用分隔符分开;

标号后用冒号，注释前用分号;

操作数之间和参数之间使用逗号分隔;

其他部分通常采用多个或一个空格:

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230215194528575.png" alt="image-20230215194528575" style="zoom:33%;" />

## 二、汇编语言源程序格式

#### 1.组成

完整源程序由段组成

一个源程序可以包含多个代码段、数据段、附加段或堆栈段

必须包含一个代码段，并确定执行的起始点，一个程序只有一个起始点

所有的汇编指令必须位于代码段内

#### 2.段定义格式

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230215201602877.png" alt="image-20230215201602877" style="zoom:50%;" />

#### 3.编程注意：

##### （1）程序开始

大多数程序需要数据段，程序执行开始应是：

start	：mov	AX，data	；data数据段的段地址

​				mov	ds，ax		；设置DS

##### （2）程序的终止

1⃣️普通源程序的终止代码是：

​	mov ah，4ch		；mov	ax，4c00h

​	int 21h

2⃣️过程体（子程序）终止语句两种：

​							< push ds

标准序				<mov ax ，0			；XOR  	ax，ax

（标准格式）	<	push 	ax

​	……

​	ret

#### （3）汇编结束

表示汇编程序到此结束，即将源程序翻译成目标模块代码结束源程序的最后必须有:
	END	 [标号]

​	伪指令	

## 三、伪指令语句及定义

#### 1.常量

汇编语言的数据可以简单分为常量和变量

常量可以作为硬指令的立即数或伪指令的参数

变量主要作为存储器操作数

常量表示一个固定的数值，分成4种形式：

>常数
>
>字符串
>
>符号常量
>
>数值表达式

#### 2.符号常量的定义：

使用标识符表达一个数值

符号定义伪指令有

​					“EQU” 和 “=”

​			符号名	EQU（=）	常数/数值表达式（立即数）

###### 注意：

EQU定义不占用内存空间

EQU不能重复定义符号名，但“=”允许有重复赋值。

​							<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/4731676464503_.pic.jpg" alt="4731676464503_.pic" style="zoom:50%;" />

#### 3.变量及定义

变量实质上是指内存单元中数据的地址；

变量需要事先定义才能使用;

可以利用变量名引用其中的数据。

##### （1）变量定义

汇编语言格式为：

​		变量名	伪指令	参数项

变量名：参数项首元素的逻辑地址；

伪指令：DB、DQ、DD；

复制操作符DUP定义多个相同元素：

​			重复次数		DUP		（重复参数）

##### （2）DB（Define	Byte）

用于分配一个或多个字节单元；

初值表中每个数据一定是字节量，8位数据：

​		0～255的无符号数

​		-128～+127带符号数

​		字符串常量

例1.<img src="/Users/mingmingbushimingming/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/697fbac40d91e745b8859dbd699e5a28/Message/MessageTemp/03f008294b09bd221423f947eee3d31b/Image/4751676465400_.pic.jpg" alt="4751676465400_.pic" style="zoom:50%;" />

#####  （3）DW（Define	Word）

DW伪指令：用于分配一个或多个字单元；

初值表中每个数据一定是字量，16位数据：

​		0～65535的无符号数

​		-32768～+32767带符号数

​		两个字符

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230215211704799.png" alt="image-20230215211704799" style="zoom:50%;" />

##### （4）DD（Define Double word）

DD伪指令：用于分配一个或多个双字单元；

初值表中每个数据是一个32位的双字量：

​	V1	DD	0，？，12345678h

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230215213005946.png" alt="image-20230215213005946" style="zoom:33%;" /><img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230215213019838.png" alt="image-20230215213019838" style="zoom:33%;" />

##### （5）变量的定位

段中定义的第一个变量从0地址开始；

按照定义的先后顺序依次分配存储空间；

ORG控制数据或代码所在的偏移地址：

​	ORG	参数

例如：

​	ORG	100H	；从100H处安排数据或程序

##### （6）存储器寻址方式中的变量

1⃣️单独引用变量名是直接寻址方式

WVAR	DW	1234H			；假设其偏移地址为10H

​				MOV	AX，WVAR ；等同MOV	AX，[0010H]

2⃣️相对寻址方式，变量名表示其位移量

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230215214659013.png" alt="image-20230215214659013" style="zoom:60%;" />

##### （7）名字和标号属性

名字指向一条伪指令，标号指向一条硬指令

具有两种属性：

​			地址：段地址和偏移地址；

​			类型：

​					变量类型：BYTE、WORD、DWORD

​					标号、段名、子程序名的类型：NEAR（段内）和FAR（段间）

###### 1⃣️地址操作符

名字或标号的段地址和偏移地址

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230215215459593.png" alt="image-20230215215459593" style="zoom:50%;" />

###### 2⃣️类型操作符

对名字或标号的类型属性进行设置

​			类型名 	PTR	名字标号

类型名可以是：

​		名字：BYTE、WORD、DWORD，等

​		标号：NEAR、FAR等

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230215215716632.png" alt="image-20230215215716632" style="zoom:33%;" />

#### 4.段定义

##### （1）格式

​				段名		segment

​				……

​				段名		ends

（2）assume		DS：数据段名，CS：代码段名，……

​	指定逻辑地址与物理地址之间的对应关系用MOV指令实现：

​		MOV		AX，段名

​		MOV		DS，AX

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230215220913495.png" alt="image-20230215220913495" style="zoom:50%;" />

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230215220927015.png" alt="image-20230215220927015" style="zoom:50%;" />

#### 5.过程定义

（1）格式：

​			过程名		proc		[属性NEAR或FAR]

​			过程名		endp

###### 例<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230215221417631.png" alt="image-20230215221417631" style="zoom:33%;" />

###### 例二、中断服务子程序的一般构成：

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230215221501004.png" alt="image-20230215221501004" style="zoom:50%;" />

## 四、顺序程序设计

没有分支、循环等转移指令的程序，会按指令书写的前后顺利依次执行，这就是顺序程序

顺序结构是最基本的程序结构

完全采用顺序结构编写的程序并不多见

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230215225539153.png" alt="image-20230215225539153" style="zoom:50%;" />

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230215225552897.png" alt="image-20230215225552897" style="zoom:50%;" />

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230215225603688.png" alt="image-20230215225603688" style="zoom:50%;" />

## 五、分支程序设计

根据条件是真或假决定执行与否;

判断的条件的指令，如CMP、TEST，执行后形成的状态标志;

转移指令Jcc和JMP可以实现分支控制

例一、

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230216164034161.png" alt="image-20230216164034161" style="zoom:60%;" />

###### 例二、

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230216163928601.png" alt="image-20230216163928601" style="zoom:33%;" /><img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230216163940401.png" alt="image-20230216163940401" style="zoom:33%;" /><img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230216164000962.png" alt="image-20230216164000962" style="zoom:33%;" />

###### 例三、

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230216163824470.png" alt="image-20230216163824470" style="zoom:33%;" /><img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230216163837242.png" alt="image-20230216163837242" style="zoom:33%;" />

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230216163852512.png" alt="image-20230216163852512" style="zoom:60%;" />

### 六、循环程序设计

满足一定条件的情况下，重复执行某段程序

#### 1.三个组成部份

​		循环初始部份：设置循环条件，如循环次数、循环初值等

​		循环体部份：指重复执行的程序部份

​		循环控制部份：判断循环条件是否成立，决定是否继续循环

#### 2.循环控制两种结构：

1⃣️先判断再循环

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230216163759576.png" alt="image-20230216163759576" style="zoom:60%;" />

2⃣️先循环再判断

### 3.循环控制方法

（1）循环次数

（2）特定条件：计数控制循环，条件控制循环

#### 一、计数控制循环：

LOOP

三部分：

​			初始化：循环次数置入CX；

​			循环体

​			循环控制：对CX减1，并判断是否为0

###### 例一、

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230216163735742.png" alt="image-20230216163735742" style="zoom:60%;" />

###### 例二、<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230216165305510.png" alt="image-20230216165305510" style="zoom:33%;" /><img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230216165315051.png" alt="image-20230216165315051" style="zoom:33%;" />

#### 二、条件控制循环

需要利用特定条件判断循环是否结束

条件转移指令判断循环条件

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230216170324541.png" alt="image-20230216170324541" style="zoom:40%;" />

## 七、汇编语言程序的上机过程

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230216170332772.png" alt="image-20230216170332772" style="zoom:60%;" />

##### 知识总结

掌握常量表达、变量定义及应用、变量和标号的属性及操作符

掌握汇编语言源程序的编辑、汇编、连接和调试的开发方法

掌握基本伪指令和操作符:

EQU /=;

DB /DW /DD、? /DUP;

ORG、OFFSET / SEG / PTR;

SEGMENT  /END /ASSUME

PROC/ENDP

##### 大纲知识范围

指令系统的概念、指令格式;

对操作数的寻址方式;

常用指令(传送指令、算术运算指令、逻辑运算和移位指令、串操作指令、程序控制指令与处理器控制指令):

汇编语言程序的基本结构:

常用伪指令(数据定义、符号定义、段定义、设定段寄存器) ;

DOS 功能调用 (输入/输出字符、输入/输出字符串、结束程序)

三种结构(顺序结构、分支结构和循环结构) 程序设计;

常用程序设计举例。

# 第七-八章	输入输出系统及接口芯片

## 第七章 输入输出系统

#### 考核要求

1.了解外设为什么不能直接与总线连接，接口起什么作用，了解接口完成的功能

2.掌握接口内部基本组成:

3.掌握端口的概念，明确端口与接口的关系;

4.掌握端口的2种编址方式及各自特点。

5.掌握常用的输入/输出方法，理解其各自特点及应用场合

6.要求深入理解条件传送方式和中断传送方式的区别。

### 7.1	输入输出（I/O）接口概念

#### 一、I/O接口概念

##### 1.为什么需要I/O接口（电路）？

​	微机的外部设备多种多样

​	工作原理、信息格式、工作速度等方面差别很大

​	外设不能与CPU直接相连，必须经过中间电路再与系统相连

​	这部分电路被称为I/O接口电路

##### 2.什么是I/O接口（电路）？

I/O接口是位于系统与外设间、用来协助完成数据传送和控制任务的逻辑电路；

可编程接口芯片、I/O总线槽的电路板（适配器）都是接口电路；

##### 3.I/O接口的主要功能

（1）速度匹配、数据缓冲：

（2）数据格式转换：

（3）对I/O端口寻址、地址译码：

（4）CPU与外设信息联络：

（5）设置中断和DMA控制逻辑：

##### 4.端口（PORT）

泛指I/O地址，对应接口电路的寄存器；

一个接口电路可以具有多个I/O端口（寄存器）

数据端口、状态端口和控制端口：

​			用于保存数据、状态和控制信息

#### 二、I/O接口的典型结构

##### 1.接口结构

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230216191528130.png" alt="image-20230216191528130" style="zoom:50%;" />

#### 2.I/O接口组成

​	接口由硬件和软件组成

接口软件有两类：

​	初始化程序段：

​			设备驱动程序、设定芯片工作方式等

​	数据交换程序段：

​			管理、控制、驱动外设，负责外设和系统间信息交换

#### 三、I/O端口的编址

两类编址

​	I/O端口单独编址

> ​	I/O空间 独立于存储地址空间
>
> ​	如8086/8088

​	I/O端口与存储器统一编址

> ​	他们共享一个地址空间
>
> ​	如M6800

##### 1.I/O端口单独编址

优点：

> I/O端口的地址空间独立
>
> 控制的地址译码电路简单
>
> 专门的I/O指令

缺点：

> I/O指令种类少
>
> I/O空间小

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230216194124425.png" alt="image-20230216194124425" style="zoom:33%;" />

##### 2.I/O端口与存储器统一编址

优点：

> 不需要专门的I/O指令
>
> I/O数据存取灵活

缺点：

> I/O端口要占去部份存储器地址空间
>
> 程序不易阅读（不易分清访问主存和访问外设）

#### 四、88/86的输入输出指令

##### 1.I/O端口地址

​	外设的端口（Port），即I/O地址

​	88/86用于寻址外设端口的地址线为16条

​	端口最多为$2^{16}$=65536(64KB)个

​	端口号为0000H~FFFFH

##### 2.I/O端口寻址方式

88/86的端口有64KB，不分段，两种寻址方式：

​	直接寻址：

​			只寻址00H～FFH前256个端口

​			指令中操作数直接使用端口号

​	间接寻址：

​			可寻址全部64K个端口:0000H~FFFFH

​			DX寄存器的值存放端口号;

​			0100H~FFFFH的端口只能采用间接寻址方式

##### 3.输入指令

将外设数据传送给CPU内的AL/AX：

​	IN	AL，端口地址			；从外设端口地址上取一个字节

​	IN	AL，DX/i8				；字节输入						<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230216200015255.png" alt="image-20230216200015255" style="zoom:25%;" />

​	IN	AX，DX/i8				；字输入		从DX地址或i8地址上取一个字

##### 4.输出指令

将CPU内的AL/AX数据传送给外设：

OUT	端口地址，AL/AX

OUT	DX/i8，AL	；字节输出

OUT	DX/i8，AX	；字输出

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230216203253076.png" alt="image-20230216203253076" style="zoom:33%;" /><img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230216203305794.png" alt="image-20230216203305794" style="zoom:33%;" />

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230216203320464.png" alt="image-20230216203320464" style="zoom:33%;" />

##### 五、I/O地址的译码

门电路：接口电路只占少量I/O地址，可以利用线选法地址译码。

译码器：选用2:4或3:8进行地址译码

###### 1.逻辑门电路进行I/O地址译码

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230216205231324.png" alt="image-20230216205231324" style="zoom:33%;" /><img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230216205239976.png" alt="image-20230216205239976" style="zoom:33%;" />

### 7.2	数据传送控制方式 

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230226173839301.png" alt="image-20230226173839301" style="zoom:33%;" />

程序控制的数据传送：

​	CPU执行程序中的I/O指令完成传送，分为：

​				无条件传送、查询传送、中断传送

   直接存储器存取（DMA）

​				DMAC（8237硬件）利用系统总线在外设和主存间传送

   I/O处理机（协处理器 8089、8087）实现数据传送：

​				CPU委托专门的I/O处理机来完成数据传送

#### 一、无条件传送方式

##### 1.原理：

CPU与慢速外设交换数据;

外设处于“就绪”状态，随时可以进行数据传送，亦称同步传送:

适合于简单设备，如LED数码管、按键等

传送条件:外设必须随时就绪



#### 二、查询传送方式

##### 1.原理：

CPU先查询外设的工作状态

在外设就绪时，实现数据输入或输出;

查询传送的特点是:工作可靠

​									但传送效率低。

##### 2.查询传送的两个环节

###### （1）查询

> 寻址状态口
>
> 读取状态端口的状态位
>
> 若无就绪就继续查询

​																				<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230216222748629.png" alt="image-20230216222748629" style="zoom:33%;" />

###### （2）传送														

> 外设就绪后，寻址数据口
>
> 输入：IN指令从数据端口读入数据
>
> 输出：OUT指令向数据端口输出数据

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230216222845230.png" alt="image-20230216222845230" style="zoom:33%;" /><img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230216222857856.png" alt="image-20230216222857856" style="zoom:33%;" />

#### 三、中断传送方式

##### 1.中断原理（2.5章）

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230226172049712.png" alt="image-20230226172049712" style="zoom:33%;" />

##### 2.特点

1⃣️是一种效率较高的程序传送方式；

2⃣️中断服务程序是预先设计好的；

3⃣️CPU在每条	指令周期后	采样中断请求输入信号;、<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230226173307524.png" alt="image-20230226173307524" style="zoom:25%;" />

4⃣️外设需要传数据时，主动向CPU提出中断请求，提高实时性；

5⃣️外设准备数据和CPU执行程序并行工作，提高了CPU效率；

6.每传输一次数据就要中断一次，需要保护断点和现场<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230226173156242.png" alt="image-20230226173156242" style="zoom:33%;" />		<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230226173211922.png" alt="image-20230226173211922" style="zoom:33%;" />

7.需要中断控制器芯片8259

8.适合少量数据、中慢速外设的数据传送，如键盘鼠标

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230226174310530.png" alt="image-20230226174310530" style="zoom:33%;" /><img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230226174320044.png" alt="image-20230226174320044" style="zoom:33%;" />

#### 四、DMA传送方式

##### 1.特点

克服程序控制传送的不足

​			外设《--	CPU《--	存储器

​			外设	--》CPU	--》存储器

直接存储器存取DMA

​			外设《--	存储器

​			外设	--》存储器

DMA传送中，CPU释放总线，由DMA控制器（8237）管理

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230226175003939.png" alt="image-20230226175003939" style="zoom:50%;" />

##### 2.DMA传送原理

(1)CPU对DMA控制器8237进行初始化设置;

(2) 外设、DMAC和CPU三者通过应答信号建立联系；

​	  CPU将总线交给DMAC控制;

(3)DMAC控制数据在内存和外设间传送

​		-DMA读存储器:存储器 ->外设

​		-DMA写存储器:元存储器->外设

(4)自动增减地址和计数，判断传送完成否。

##### 3.DMA传送过程

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230226180936064.png" alt="image-20230226180936064" style="zoom:50%;" />

DMA传送过程

> 1.外设向DMAC发出请求;														请求CPU总线

> 2.DMAC向CPU申请总线 (hold);

> 3.CPU完成当前总线周期后响应 (hlda)，并释放总线控制权;

> 4.DMAC得到总线控制权，发出DMA响应信号;

5.由DMAC发出读写控制信号，控制外设与存储器之间的数据传送

> 6.数据传送完后，DMAC撤销HOLD信号;							归还CPU总线

> 7.CPU释放HLDA信号，并重新控制总线。

#### 总结：传送方式的比较

无条件传送:慢速外设需与CPU保持同步。

查询传送:简单实用，CPU效率较低。

中断传送:外设主动、实时性高，与CPU并行工作，CPU效率高，但每次传送需要大量额外时间开销，适于中慢速外设 。

DMA传送:传送过程中由专门硬件DMAC控制，不需要CPU介入，外设直接和主存进行数据传送，适合大量、快速数据传送

#### DMA方式与中断方式的区别在于

(1)DMA方式是依靠硬件来实现存储器和外设之间的数据传送

​		而中断方式是通过执行中断服务程序来实现数据传送

(2) CPU对DMA的响应在指令执行的总线周期之后

​		而CPU对中断的响应则是在执行完一条指令之后

(3)DMA方式只能进行数据传送

​		而中断方式不仅能进行数据传送，还能处理异常事件

(4)DMA请求的优先权比中断请求高

(5)DMA方式能进行数据块的传送，传输速度快而中断方式只能按字节进行传送，传输速度较慢

## 第七章输入输出系统（2）

### 考核要求

1.了解微机并行通信的基本概念

了解在并行通信过程中“联络”信号及其作用，理解并行通信 (并行输入和输出)的实现过程。

2.掌握并行接口 8255A 的内部结构与引脚结构，

​	了解8255A 的功能特性。

3.掌握 8255A 的方式控制字和 C口的按位置位/复位控制的格式及使用

4.重点幸握 8255A 的工作方式0和方式1，（方式2）

5.掌握8255A 与系统总线及外设的连接方法

### 引言：并行通信

以计算机的字长 (8位、16位或32位) 为传输单位，一次传送一个字长的数据

适合于外部设备与微机之间进行近距离大量和快速的信息交换

如:微机与并行接口打印机、磁盘驱动器、系统板上各部件之间，接口电路板上各部件之间

### 7.3并行接口芯片8255A

#### 一、8255A的内部结构和引脚

3个8位端口：P$A_{0...7}$,P$B_{0...7}$,P$C_{0...7}$

3种工作方式：0,1,2

4个端口地址：$A_1$,$A_0$   00,01,10,11<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230226220610547.png" alt="image-20230226220610547" style="zoom:33%;" />

2个控制字：

​			方式控制字：

​			C口的按位置位/复位字：

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230226220627393.png" alt="image-20230226220627393" style="zoom:50%;" />

##### 1.与外设连接的端口

端口A：P$A_{0...7}$

​			常做数据端口，功能最强大

​			支持工作方式0，1，2

端口B：P$B_{0...7}$

​			常做数据端口，支持工作方式0，1

端口C：P$C_{0...7}$

​			可作数据、状态和控制端口

​			分两个4位，每位可单独操作

​			仅支持工作方式0

##### 2.与处理器连接的引脚

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230227100306345.png" alt="image-20230227100306345" style="zoom:50%;" />

##### 3.8255的4个端口地址

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230227100458552.png" alt="image-20230227100458552" style="zoom:33%;" />

#### 二、8255A的工作方式

##### 1.三种工作方式

​		方式0:基本输入输出方式

​			适用于 无条件传送和查询方式的接口电路

​		方式1:选通输入输出方式

​			适用于 查询和中断方式的接口电路

​		方式2:双向选通传送方式

​			适用于 查询和中断方式的接口电路

##### 2.方式0:基本I/O方式

通常不用联络信号（C口）或不使用（CPU给的）固定的联络信号;

PA、PB和两个4位PC都可以作为数据的入/出 (由程序设定) ;

方式0适于无条件传送和查询传送;

​		输入时，使用IN指令

​		输出时，使用OUT指令;

##### 3.方式1:选通I/O方式

通常使用（CPU）固定的联络信号;

适于 查询和中断方式

可以产生中断;

一般作为中断方式I/O

输入使用IN指令，输出使用OUT指令

###### （1）方式1:输入、A端口

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230227104250716.png" alt="image-20230227104250716" style="zoom:50%;" />

###### （2）方式1 输入引脚：B端口

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230227104408015.png" alt="image-20230227104408015" style="zoom:50%;" />

###### 方式1 输入联络信号

$\overline{STB}$ : 选通信号，低电平有效

​			-外设提供的输入信号，有效时，将输入设备送来的数据锁存至8255A的输入锁存器

IBF: 输入缓冲器满信号，高电平有效

​			-8255A输出的联终信号。有效时，表示数据已锁存在输入锁存器

INTR: 中断请求信号，高电平有效

​			8255A输出的信号，向CPU提出中断请求，要求CPU读取外设数据

###### （3）方式1 输出引脚：A端口

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230227110826418.png" alt="image-20230227110826418" style="zoom:33%;" />

###### （4）方式1 输出引脚：B端口

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230227110836882.png" alt="image-20230227110836882" style="zoom:50%;" />

###### 方式1 输出联络信号

$\overline{OBF}$  : 输出缓冲器满信号，低有效

​			输出给外设，有效时，表示CPU已把数据输出给指定的端口,外设可以取走。

$\overline{ACK}$  : 响应信号，低有效

​			-外设的响应信号，指示8255A的端口数据已由外设接收。

INTR: 中断请求信号，高有效

​			当输出设备已接收数据后，此信号向CPU提出中断请求，要求CPU继续提供数据

###### 方式2：双向方式

方式2可以同时发送数据和接收数据

只有端口A可以工作于方式2

端口B可用于方式0或方式1

需要利用端口C的信号线

#### 三、8255A的编程

##### 1.编程步骤

1⃣️根据题意明确三个端口的工作方式和方向;

2⃣️确定两个字:方式控制字&置位/复位字;

3⃣️确定4个端口地址:依次A、B、C和控制口;

4⃣️8255的初始化编程:两个字送到控制端口

5⃣️8255的功能驱动编程。

##### 2.方式控制字格式

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230227112714354.png" alt="image-20230227112714354" style="zoom:50%;" />

##### 3.C口的置位/复位字

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230227112928406.png" alt="image-20230227112928406" style="zoom:50%;" />

###### 例：<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230227122347809.png" alt="image-20230227122347809" style="zoom:50%;" />

###### 例2.<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230227125130379.png" alt="image-20230227125130379" style="zoom:33%;" /><img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230227125150478.png" alt="image-20230227125150478" style="zoom:33%;" />

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230227122740145.png" alt="image-20230227122740145" style="zoom:33%;" /><img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230227122750559.png" alt="image-20230227122750559" style="zoom:33%;" />

###### 例：<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230227125212989.png" alt="image-20230227125212989" style="zoom:50%;" />

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230228220515120.png" alt="image-20230228220515120" style="zoom:33%;" />

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230228220529281.png" alt="image-20230228220529281" style="zoom:33%;" /><img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230228220545032.png" alt="image-20230228220545032" style="zoom:33%;" /><img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230228220559582.png" alt="image-20230228220559582" style="zoom:50%;" />

###### 例4：<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230228220617124.png" alt="image-20230228220617124" style="zoom:50%;" />

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230228220628126.png" alt="image-20230228220628126" style="zoom:33%;" /><img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230228220635571.png" alt="image-20230228220635571" style="zoom:33%;" />

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230228220643694.png" alt="image-20230228220643694" style="zoom:50%;" />

##### 补充1：LED数码管的工作原理

7段发光管顺时针分别称为a、b、c、d、e、f、g带有一个小数点h通过7个发光段的不同组合
	-主要显示0~9
	-也可以显示A~F
	(实现16进制数的显示) <img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230228221004344.png" alt="image-20230228221004344" style="zoom:25%;" />

###### LED数码管的结构

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230228221128609.png" alt="image-20230228221128609" style="zoom:33%;" />

##### 补充2：软件延时

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301101649116.png" alt="image-20230301101649116" style="zoom:50%;" />

### 7.4 串行通信基础

#### 一、概念

##### 1.串行通信

定义:将数据以二进制位形式用一条信号线，一位一位顺序传送的方式;

特点:用于通信的线路少，适合于远距离数据传送，也常用于速度要求不高的近距离数据传送;

应用: PC系列机上有两个串行异步通信接口、键盘、鼠标器与主机间采用串行数据传送;

##### 2.异步

串行通信时的数据、控制和状态信息都使用同一根信号线传送;

收发双方必须遵守共同的通信协议 (规程)，才能解决传送速率、信息格式、同步、校验等问题;

串行异步通信以字符为单位进行传输，其通信协议是起止式异步通信协议。

###### （1）协议格式

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301104300782.png" alt="image-20230301104300782" style="zoom:50%;" />

###### （2）数据传输效率

也称比特率(Bit Rate)

定义: 每秒传输的二进制位数( bps),

​				单位:波特或bit/s

​	数据传输速率的倒数:每个二进制位传输的时间

​	采用二进制传输时，比特率等于波特率(Baud Rate）

串行异步通信的数据传输速率在50 bps到9600 bps之间。高达115200bps或更高

###### （3）波特因子

接收器或发送器的频率/数据传输的波特率，

​	在8251（串行）芯片中有三种1，16，64

##### 3.同步通信

以一个数据块(帧)为传输单位，每个数据块附加1个或2个同步字符，最后以校验字符结束

同步通信的数据传输效率和传输速率较高，但硬件电路比较复杂

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301105900458.png" alt="image-20230301105900458" style="zoom:50%;" />

##### 4.传输制式

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301105942218.png" alt="image-20230301105942218" style="zoom:50%;" />

##### 5.8250

8250实现了起止式串行异步通信协议，支持全双工通信

数据位为5~8位

-停止位1、1.5或2位

-奇偶校验1位

- 具有奇偶、帧和溢出错误检测电路
- 8250支持的数据传输速率为50~9600bps

##### 6.8251

串行同步/异步通信，支持全双工通信

​		-数据位为5~8位

​		-停止位1、1.5或2位

​		-偶校验1位

​		-具有奇偶、帧和溢出错误检测电路

支持同步波特率为0~64bps

支持异步波特率为0~19.2kbps

## 第八章 控制器芯片

### 考核要求

了解中断控制器8259的基本结构与工作原理。

### 8.1中断控制器8259A

可编程中断控制器PIC

用于管理Intel 8086/8088

​									80286/80386的可屏蔽中断

8259A的基本功能:

​	一片8259A可以管理8级中断，可扩展（级联）至64级（9片）

- 每一级中断都可单独被屏蔽或允许
- 在中断响应周期，可提供相应的中断向量号
- 8259A有多种工作方式，可通过编程选择

#### 一、8259的内部结构

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301130400092.png" alt="image-20230301130400092" style="zoom:50%;" />

##### 1.内部寄存器

中断请求寄存器IRR：

中断服务寄存器ISR

中断屏蔽寄存器IMR

##### 2.处理器接口

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301155506521.png" alt="image-20230301155506521" style="zoom:33%;" />

##### 3.中断级连

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301163019181.png" alt="image-20230301163019181" style="zoom:50%;" />

1⃣️8259A可以级连，一个主8259A，若千个(最多8个)从8259A;

2⃣️级连时，主8259A的CASO ～CAS2为输出线，连至从8259A的CASO～CAS2

3⃣️从8259A的INT，连主8259A的IR;

4⃣️主8259A的INT线连至CPU的INTR

5⃣️SP/EN在非缓冲方式下，

​			SP=1时，8259A是主片

​			SP=0时8259A是从片。

#### 二、8259A的中断过程

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301170412488.png" alt="image-20230301170412488" style="zoom:50%;" />

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301170422179.png" alt="image-20230301170422179" style="zoom:50%;" />

#### 三、8259A的工作方式 

###### 1.设置优先权方式

>    优先权固定方式
>
> >普通全嵌套方式
> >
> >​			8259A的中断优先权顺序固定不变，从高到低依次为IRO>IR1>IR2、......>IR7
> >
> >​			中断请求后，8259A响应最高优先级，ISR对应位置位=1，直到中断结束，ISR的位复位=0;
> >
> >​			在ISR置位期间，禁止同级和低级优先权的中断，但允许高级优先权中断的嵌套。
> >
> >特殊全嵌套方式
> >
> >​			CPU正在处理某一级中断时，只可对本级中断进行屏蔽允许比它高的或比它低的中断源开放
>
> 优先权循环方式
>
> > 自动循环方式
> >
> > ​			初始优先级顺序为IR0最高，IR7最低;当某一个中断源受到服务后，它的优先级改为最低级而比它低一级的中			断源为最高优先级，其他级别依次类推。
> >
> > 特殊循环方式
> >
> > ​			与优先级自动循环方式基本相同，不同点仅在于可以根据用户要求将最低优先级赋于某一中断源。

###### 2.结束中断处理方式

8259A利用中断服务寄存器ISR判断:

​	某位为1，表示正在进行中断服务;

​	该位为0，就是该中断结束服务。

>自动中断结束方式
>
>>普通中断结束方式
>>
>>​		配合全嵌套优先权方式使用
>>
>>​		当CPU往8259A发中断结束命令（EOI）时，8259A就会把所有正在服务的中断优先权最高的ISR位复位。
>>
>>特殊中断结束方式	
>>
>>​		配合循环优先权方式使用CPU向8259A发送一条特殊中断结束命令，指出要清除哪个ISR位		

###### 3.屏蔽中断源方式

>普通屏蔽方式
>
>​		只允许高优先级的中断源请求
>
>​		不允许同级或低级的中断源请求
>
>特殊屏蔽方式
>
>​		将IMR的Di位置1，使ISR的Di位置0
>
>​		只对本级中断进行屏蔽

###### 4.中断请求方式

>边沿触发方式
>
>​		中断请求输入输出端出现的上升沿作为中断请求信号，不能跳变。<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301175258311.png" alt="image-20230301175258311" style="zoom:33%;" />
>
>电平触发方式
>
>​		中断请求端的高电平是有效的中断请求信号。响应后，必须撤销信号。<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301175307609.png" alt="image-20230301175307609" style="zoom:33%;" />
>
>中断查询方式
>
>​		IF=0（关中断），查询IR0～IR7有无中断请求		

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301184435860.png" alt="image-20230301184435860" style="zoom:33%;" />

###### 5.数据线连接方式

>缓冲方式
>
>​		8259A的数据线需加缓冲器（驱动器）予以驱动
>
>​		多片级联的系统
>
>非缓冲方式
>
>​		$\overline{SP}$/$\overline{EN}$引脚为输入端
>
>​		8259直接和数据线相连
>
>​		用于单片，引脚接高电平
>
>​		级连时，由引脚确定是主片（高）或从片（低）

#### 四、8259A的编程

初始化编程

​		8259A开始工作前，必须进行初始化编程

​		给8259A写入初始化命令字ICW

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301184423533.png" alt="image-20230301184423533" style="zoom:50%;" />

##### 1.初始化命令字

初始化命令字ICW最多有4个

必须按照ICW1~ICW4顺序写入

ICW1和ICW2是必须送的:

ICW3用于级联

ICW4用于8088/8086

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301190414639.png" alt="image-20230301190414639" style="zoom:33%;" /><img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301190424096.png" alt="image-20230301190424096" style="zoom:33%;" />

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301190435324.png" alt="image-20230301190435324" style="zoom:33%;" /><img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301190444332.png" alt="image-20230301190444332" style="zoom:33%;" />

##### 2.操作命令字OCW

8259A工作期间，可以接受操作命令字OCW;

OCW共有3个:OCW1~OCW3

写入时没有顺序要求，需要哪个OCW就写入那个OCW

OCW1写入奇地址

OCW2写入偶地址

OCW3写入偶地址

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301191216752.png" alt="image-20230301191216752" style="zoom:40%;" />

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301191237291.png" alt="image-20230301191237291" style="zoom:40%;" />

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301191324249.png" alt="image-20230301191324249" style="zoom:40%;" />

## 8.2 定时/计数控制器8253

## 考核要求

1.可编程计数/定时器8253 的结构、初始化编程和工作方式。
2.掌握定时/计数器 8253 的内部结构与引脚结构，掌握其工作原理。

#### 一、定时/计数原理

定时器：由计数电路组成，通过记录高精度晶体脉冲信号的个数，输出准确的时间间隔。

计数器：计数电路如果记录外设提供的具有一定随机性的脉冲信号时，它主要反映脉冲的个教。

均采用减1计数的倒计数原理，每过一个CLK周期计算器减1

软件延时

> 利用CPU执行一个延时程序段实现
> 不用硬件，但占用CPU时间、定时精度不高，随系统主频改变
>
> 

可编程的硬件定时

> 软件硬件相结合、可编程定时器芯片 (8253)
>
> 能够输出多种控制信号

#### 二、8253内部结构和引脚

##### 1.原理

2种计数制:按二进制或BCD码计数

3个独立的16位计数器

4个端口地址

6种工作方式

##### 2.结构

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301200741161.png" alt="image-20230301200741161" style="zoom:50%;" />

##### 3.引脚

CLK:时钟输入信号 $F_{clk}$,$T_{clk}$

GATE: 门控输入信号

​		-控制计数器是否计数

​		-两种:高电平控制和上升沿控制

OUT: 计数器输出信号

​		-当计数值减为0，OUT引脚上产生一个输出信号$F_{out}$,$T_{out}$

##### 4.与处理器接口

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301201317789.png" alt="image-20230301201317789" style="zoom:50%;" />

##### 5.8253的I/O地址：4个

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301201544331.png" alt="image-20230301201544331" style="zoom:50%;" />

#### 三、8253的工作方式

8253有6种工作方式，由方式控制字确定

##### 1.工作方式类型

方式0: 计数结束中断

方式1: 可编程单稳脉冲

方式2:频率发生器(分频器）

方式3: 方波发生器

方式4: 软件触发选通信号

方式5: 硬件触发选通信号

##### 2.工作方式特点：

只有方式2和3为自动装入初值循环计数;

方式1和5由外部gate上升沿触发启动计数器;

方式0~4为计数值启动后，开始计数;

方式1的输出波形全为负电平: Tout=N * Tclk

方式2的输出波形:Tout中有1个Tclk的负电平

方式3初值N为偶数：N/2 * Tout的高（低电平）

​				 N为奇数：$(N+1)/2*T_{out}$ 的高电平

​									(N-1)/2*Tout 的低电平

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301203808349.png" alt="image-20230301203808349" style="zoom:33%;" /><img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301203817046.png" alt="image-20230301203817046" style="zoom:33%;" />

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301203828719.png" alt="image-20230301203828719" style="zoom:33%;" /><img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301203840068.png" alt="image-20230301203840068" style="zoom:33%;" />

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301203851925.png" alt="image-20230301203851925" style="zoom:33%;" /><img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301203902171.png" alt="image-20230301203902171" style="zoom:33%;" />

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301203910749.png" alt="image-20230301203910749" style="zoom:60%;" />



#### 四、8253的编程

（1）确定8253的4个端口地址

（2）确定CPU写入8253的初值和计数制

（3）确定CPU写入8253的方式控制字

（4）编写8253的初始化程序段

##### 1.方式控制字

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301203755310.png" alt="image-20230301203755310" style="zoom:60%;" />

##### 2.计数值：N

二进制：0～65535	最大值为0，相当于65536

BCD码：0～9999 	最大值为0，相当于10000

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230301204214133.png" alt="image-20230301204214133" style="zoom:33%;" />

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230302101129288.png" alt="image-20230302101129288" style="zoom:33%;" /><img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230302101139205.png" alt="image-20230302101139205" style="zoom:33%;" />

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230302101149103.png" alt="image-20230302101149103" style="zoom:50%;" />

###### 考点：8253级联

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230302101222555.png" alt="image-20230302101222555" style="zoom:50%;" />

## 8.3	DMA控制器

### 一、DMA概述

为了提高数据传送的速率，提出了DMA数据传送控制方式

由DMA控制器取代CPU，获得CPUD总线控制权

实现内存与外设 或者 内存的不同区域之间 或者外设与外设大量数据的快速传送

用于:图像的显示、磁盘的存取、磁盘间的数据传送等

### 二、DMA数据传送的工作过程

<img src="/Users/mingmingbushimingming/Library/Application Support/typora-user-images/image-20230302101502996.png" alt="image-20230302101502996" style="zoom:50%;" />

(1) 接收从外设发出的DMA请求，并向CPU发出总线请求信号。

(2)当CPU响应请求，发出HLDA后，DMA控制器能接管对总线的控制，进入DMA操作方式。

(3) 发出存储器地址，确定数据传送的地址单元，并能自动修改地址指针。

(4)识别数据传送的方向，发出读或写控制信号

(5) 确定传送数据的个数，判断传送是否结束。

(6) 发出DMA操作的结束信号。

#### 
